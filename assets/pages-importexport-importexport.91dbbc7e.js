import{a0 as e,a1 as t,a2 as i,y as l,a3 as s,a4 as o,o as a,c as r,w as n,b as d,F as p,r as u,l as c,a as h,Z as f,d as m,h as y,A as g,m as b,i as x,a5 as F,k,t as $,e as _,p as w,D as v,q as T,u as P,z as S,g as I,v as j,a6 as C,a7 as E,f as O}from"./index-de2112c1.js";import{W as M,_ as L}from"./uni-data-checkbox.34de773b.js";import{_ as D,r as V}from"./uni-app.es.f5d8e4b4.js";import{_ as U,a as B}from"./uni-forms.d99627c8.js";import{_ as A}from"./uni-notice-bar.1aa35fde.js";import{_ as z}from"./uni-card.a08da529.js";import{_ as N}from"./uni-easyinput.78c90da9.js";import{l as R}from"./lodash.78ef8cd2.js";import{d as q}from"./format.e6ea6446.js";import"./uni-icons.c5d1a199.js";const J="chooseAndUploadFile:fail";function W(e,t){return e.tempFiles.forEach(((e,i)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+i+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function H(e,t=5,i){const l=(e=JSON.parse(JSON.stringify(e))).length;let s=0,o=this;return new Promise((a=>{for(;s<t;)r();function r(){let t=s++;if(t>=l)return void(!e.find((e=>!e.url&&!e.errMsg))&&a(e));const n=e[t],d=o.files.findIndex((e=>e.uuid===n.uuid));n.url="",delete n.errMsg,M.uploadFile({filePath:n.path,cloudPath:n.cloudPath,fileType:n.fileType,onUploadProgress:e=>{e.index=d,i&&i(e)}}).then((e=>{n.url=e.fileID,n.index=d,t<l&&r()})).catch((e=>{n.errMsg=e.errMsg||e.message,n.index=d,t<l&&r()}))}}))}function Z(e,{onChooseFile:t,onUploadProgress:i}){return e.then((e=>{if(t){const i=t(e);if(void 0!==i)return Promise.resolve(i).then((t=>void 0===t?e:t))}return e})).then((e=>!1===e?{errMsg:"chooseAndUploadFile:ok",tempFilePaths:[],tempFiles:[]}:e))}function G(l={type:"all"}){return"image"===l.type?Z(function(t){const{count:i,sizeType:l=["original","compressed"],sourceType:s,extension:o}=t;return new Promise(((t,a)=>{e({count:i,sizeType:l,sourceType:s,extension:o,success(e){t(W(e,"image"))},fail(e){a({errMsg:e.errMsg.replace("chooseImage:fail",J)})}})}))}(l),l):"video"===l.type?Z(function(e){const{camera:i,compressed:l,maxDuration:s,sourceType:o,extension:a}=e;return new Promise(((e,r)=>{t({camera:i,compressed:l,maxDuration:s,sourceType:o,extension:a,success(t){const{tempFilePath:i,duration:l,size:s,height:o,width:a}=t;e(W({errMsg:"chooseVideo:ok",tempFilePaths:[i],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:i,size:s,type:t.tempFile&&t.tempFile.type||"",width:a,height:o,duration:l,fileType:"video",cloudPath:""}]},"video"))},fail(e){r({errMsg:e.errMsg.replace("chooseVideo:fail",J)})}})}))}(l),l):Z(function(e){const{count:t,extension:l}=e;return new Promise(((e,s)=>{let o=i;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(o=wx.chooseMessageFile),"function"!=typeof o)return s({errMsg:J+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});o({type:"all",count:t,extension:l,success(t){e(W(t))},fail(e){s({errMsg:e.errMsg.replace("chooseFile:fail",J)})}})}))}(l),l)}const K=e=>{const t=e.lastIndexOf("."),i=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,i)}},Q=e=>{if(Array.isArray(e))return e;return e.replace(/(\[|\])/g,"").split(",")},X=async(e,t="image")=>{const i=K(e.name).ext.toLowerCase();let l={name:e.name,uuid:e.uuid,extname:i||"",cloudPath:e.cloudPath,fileType:e.fileType,url:e.path||e.path,size:e.size,image:{},path:e.path,video:{}};if("image"===t){const t=await(o=e.path,new Promise(((e,t)=>{s({src:o,success(t){e(t)},fail(e){t(e)}})})));delete l.video,l.image.width=t.width,l.image.height=t.height,l.image.location=t.path}else delete l.image;var o;return l};const Y=D({name:"uniFilePicker",components:{uploadImage:D({name:"uploadImage",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},limit:{type:[Number,String],default:9},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto",border:{}})},delIcon:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},computed:{styles(){return Object.assign({width:"auto",height:"auto",border:{}},this.imageStyles)},boxStyle(){const{width:e="auto",height:t="auto"}=this.styles;let i={};"auto"===t?"auto"!==e?(i.height=this.value2px(e),i["padding-top"]=0):i.height=0:(i.height=this.value2px(t),i["padding-top"]=0),i.width="auto"===e?"auto"!==t?this.value2px(t):"33.3%":this.value2px(e);let l="";for(let s in i)l+=`${s}:${i[s]};`;return l},borderStyle(){let{border:e}=this.styles,t={};if("boolean"==typeof e)t.border=e?"1px #eee solid":"none";else{let i=e&&e.width||1;i=this.value2px(i);let l=e&&e.radius||3;l=this.value2px(l),t={"border-width":i,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":l}}let i="";for(let l in t)i+=`${l}:${t[l]};`;return i}},methods:{uploadFiles(e,t){this.$emit("uploadFiles",e)},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},prviewImage(e,t){let i=[];1===Number(this.limit)&&this.disablePreview&&!this.disabled&&this.$emit("choose"),this.disablePreview||(this.filesList.forEach((e=>{i.push(e.url)})),o({urls:i,current:t}))},value2px:e=>("number"==typeof e?e+="px":-1===e.indexOf("%")&&(e=-1!==e.indexOf("px")?e:e+"px"),e)}},[["render",function(e,t,i,l,s,o){const k=b,$=x,_=F;return a(),r($,{class:"uni-file-picker__container"},{default:n((()=>[(a(!0),d(p,null,u(i.filesList,((e,t)=>(a(),r($,{class:"file-picker__box",key:t,style:c(o.boxStyle)},{default:n((()=>[h($,{class:"file-picker__box-content",style:c(o.borderStyle)},{default:n((()=>[h(k,{class:"file-image",src:e.url,mode:"aspectFill",onClick:f((i=>o.prviewImage(e,t)),["stop"])},null,8,["src","onClick"]),i.delIcon&&!i.readonly?(a(),r($,{key:0,class:"icon-del-box",onClick:f((e=>o.delFile(t)),["stop"])},{default:n((()=>[h($,{class:"icon-del"}),h($,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):m("",!0),e.progress&&100!==e.progress||0===e.progress?(a(),r($,{key:1,class:"file-picker__progress"},{default:n((()=>[h(_,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):m("",!0),e.errMsg?(a(),r($,{key:2,class:"file-picker__mask",onClick:f((i=>o.uploadFiles(e,t)),["stop"])},{default:n((()=>[y(" 点击重试 ")])),_:2},1032,["onClick"])):m("",!0)])),_:2},1032,["style"])])),_:2},1032,["style"])))),128)),i.filesList.length<i.limit&&!i.readonly?(a(),r($,{key:0,class:"file-picker__box",style:c(o.boxStyle)},{default:n((()=>[h($,{class:"file-picker__box-content is-add",style:c(o.borderStyle),onClick:o.choose},{default:n((()=>[g(e.$slots,"default",{},(()=>[h($,{class:"icon-add"}),h($,{class:"icon-add rotate"})]),!0)])),_:3},8,["style","onClick"])])),_:3},8,["style"])):m("",!0)])),_:3})}],["__scopeId","data-v-86b162f5"]]),uploadFile:D({name:"uploadFile",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},delIcon:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},showType:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},readonly:{type:Boolean,default:!1}},computed:{list(){let e=[];return this.filesList.forEach((t=>{e.push(t)})),e},styles(){return Object.assign({border:!0,dividline:!0,"border-style":{}},this.listStyles)},borderStyle(){let{borderStyle:e,border:t}=this.styles,i={};if(t){let t=e&&e.width||1;t=this.value2px(t);let l=e&&e.radius||5;l=this.value2px(l),i={"border-width":t,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":l}}else i.border="none";let l="";for(let s in i)l+=`${s}:${i[s]};`;return l},borderLineStyle(){let e={},{borderStyle:t}=this.styles;if(t&&t.color&&(e["border-color"]=t.color),t&&t.width){let i=t&&t.width||1,l=t&&t.style||0;"number"==typeof i?i+="px":i=i.indexOf("px")?i:i+"px",e["border-width"]=i,"number"==typeof l?l+="px":l=l.indexOf("px")?l:l+"px",e["border-top-style"]=l}let i="";for(let l in e)i+=`${l}:${e[l]};`;return i}},methods:{uploadFiles(e,t){this.$emit("uploadFiles",{item:e,index:t})},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},value2px:e=>("number"==typeof e?e+="px":e=-1!==e.indexOf("px")?e:e+"px",e)}},[["render",function(e,t,i,l,s,o){const b=x,_=F;return a(),r(b,{class:"uni-file-picker__files"},{default:n((()=>[i.readonly?m("",!0):(a(),r(b,{key:0,class:"files-button",onClick:o.choose},{default:n((()=>[g(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick"])),o.list.length>0?(a(),r(b,{key:1,class:"uni-file-picker__lists is-text-box",style:c(o.borderStyle)},{default:n((()=>[(a(!0),d(p,null,u(o.list,((e,t)=>(a(),r(b,{class:k(["uni-file-picker__lists-box",{"files-border":0!==t&&o.styles.dividline}]),key:t,style:c(0!==t&&o.styles.dividline&&o.borderLineStyle)},{default:n((()=>[h(b,{class:"uni-file-picker__item"},{default:n((()=>[h(b,{class:"files__name"},{default:n((()=>[y($(e.name),1)])),_:2},1024),i.delIcon&&!i.readonly?(a(),r(b,{key:0,class:"icon-del-box icon-files",onClick:e=>o.delFile(t)},{default:n((()=>[h(b,{class:"icon-del icon-files"}),h(b,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):m("",!0)])),_:2},1024),e.progress&&100!==e.progress||0===e.progress?(a(),r(b,{key:0,class:"file-picker__progress"},{default:n((()=>[h(_,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):m("",!0),"error"===e.status?(a(),r(b,{key:1,class:"file-picker__mask",onClick:f((i=>o.uploadFiles(e,t)),["stop"])},{default:n((()=>[y(" 点击重试 ")])),_:2},1032,["onClick"])):m("",!0)])),_:2},1032,["class","style"])))),128))])),_:1},8,["style"])):m("",!0)])),_:3})}],["__scopeId","data-v-5d376bd5"]])},options:{virtualHost:!0},emits:["select","success","fail","progress","delete","update:modelValue","input"],props:{modelValue:{type:[Array,Object],default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},delIcon:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},mode:{type:String,default:"grid"},fileMediatype:{type:String,default:"image"},fileExtname:{type:[Array,String],default:()=>[]},title:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto"})},readonly:{type:Boolean,default:!1},returnType:{type:String,default:"array"},sizeType:{type:Array,default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]}},data:()=>({files:[],localValue:[]}),watch:{modelValue:{handler(e,t){this.setValue(e,t)},immediate:!0}},computed:{filesList(){let e=[];return this.files.forEach((t=>{e.push(t)})),e},showType(){return"image"===this.fileMediatype?this.mode:"list"},limitLength(){return"object"===this.returnType?1:this.limit?this.limit>=9?9:this.limit:1}},created(){M.config&&M.config.provider||(this.noSpace=!0,M.chooseAndUploadFile=G),this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.form&&this.formItem&&this.formItem.name&&(this.rename=this.formItem.name,this.form.inputChildrens.push(this))},methods:{clearFiles(e){0===e||e?this.files.splice(e,1):(this.files=[],this.$nextTick((()=>{this.setEmit()}))),this.$nextTick((()=>{this.setEmit()}))},upload(){let e=[];return this.files.forEach(((t,i)=>{"ready"!==t.status&&"error"!==t.status||e.push(Object.assign({},t))})),this.uploadFiles(e)},async setValue(e,t){const i=async e=>{let t="";return t=e.fileID?e.fileID:e.url,/cloud:\/\/([\w.]+\/?)\S*/.test(t)&&(e.fileID=t,e.url=await this.getTempFileURL(t)),e.url&&(e.path=e.url),e};if("object"===this.returnType)e?await i(e):e={};else{e||(e=[]);for(let t=0;t<e.length;t++){let l=e[t];await i(l)}}this.localValue=e,this.form&&this.formItem&&!this.is_reset&&(this.is_reset=!1,this.formItem.setValue(this.localValue));let l=Object.keys(e).length>0?e:[];this.files=[].concat(l)},choose(){this.disabled||(this.files.length>=Number(this.limitLength)&&"grid"!==this.showType&&"array"===this.returnType?l({title:`您最多选择 ${this.limitLength} 个文件`,icon:"none"}):this.chooseFiles())},chooseFiles(){const e=Q(this.fileExtname);M.chooseAndUploadFile({type:this.fileMediatype,compressed:!1,sizeType:this.sizeType,sourceType:this.sourceType,extension:e.length>0?e:void 0,count:this.limitLength-this.files.length,onChooseFile:this.chooseFileCallback,onUploadProgress:e=>{this.setProgress(e,e.index)}}).then((e=>{this.setSuccessAndError(e.tempFiles)})).catch((e=>{console.log("选择失败",e)}))},async chooseFileCallback(e){const t=Q(this.fileExtname);(1===Number(this.limitLength)&&this.disablePreview&&!this.disabled||"object"===this.returnType)&&(this.files=[]);let{filePaths:i,files:s}=((e,t)=>{let i=[],s=[];return t&&0!==t.length?(e.tempFiles.forEach((e=>{const l=K(e.name).ext.toLowerCase();-1!==t.indexOf(l)&&(s.push(e),i.push(e.path))})),s.length!==e.tempFiles.length&&l({title:`当前选择了${e.tempFiles.length}个文件 ，${e.tempFiles.length-s.length} 个文件格式不正确`,icon:"none",duration:5e3}),{filePaths:i,files:s}):{filePaths:i,files:s}})(e,t);t&&t.length>0||(i=e.tempFilePaths,s=e.tempFiles);let o=[];for(let l=0;l<s.length&&!(this.limitLength-this.files.length<=0);l++){s[l].uuid=Date.now();let e=await X(s[l],this.fileMediatype);e.progress=0,e.status="ready",this.files.push(e),o.push({...e,file:s[l]})}this.$emit("select",{tempFiles:o,tempFilePaths:i}),e.tempFiles=s,this.autoUpload&&!this.noSpace||(e.tempFiles=[])},uploadFiles(e){return e=[].concat(e),H.call(this,e,5,(e=>{this.setProgress(e,e.index,!0)})).then((e=>(this.setSuccessAndError(e),e))).catch((e=>{console.log(e)}))},async setSuccessAndError(e,t){let i=[],l=[],s=[],o=[];for(let a=0;a<e.length;a++){const t=e[a],r=t.uuid?this.files.findIndex((e=>e.uuid===t.uuid)):t.index;if(-1===r||!this.files)break;if("request:fail"===t.errMsg)this.files[r].url=t.path,this.files[r].status="error",this.files[r].errMsg=t.errMsg,l.push(this.files[r]),o.push(this.files[r].url);else{this.files[r].errMsg="",this.files[r].fileID=t.url;/cloud:\/\/([\w.]+\/?)\S*/.test(t.url)?this.files[r].url=await this.getTempFileURL(t.url):this.files[r].url=t.url,this.files[r].status="success",this.files[r].progress+=1,i.push(this.files[r]),s.push(this.files[r].fileID)}}i.length>0&&(this.setEmit(),this.$emit("success",{tempFiles:this.backObject(i),tempFilePaths:s})),l.length>0&&this.$emit("fail",{tempFiles:this.backObject(l),tempFilePaths:o})},setProgress(e,t,i){this.files.length;const l=Math.round(100*e.loaded/e.total);let s=t;i||(s=this.files.findIndex((t=>t.uuid===e.tempFile.uuid))),-1!==s&&this.files[s]&&(this.files[s].progress=l-1,this.$emit("progress",{index:s,progress:parseInt(l),tempFile:this.files[s]}))},delFile(e){this.$emit("delete",{tempFile:this.files[e],tempFilePath:this.files[e].url}),this.files.splice(e,1),this.$nextTick((()=>{this.setEmit()}))},getFileExt(e){const t=e.lastIndexOf("."),i=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,i)}},setEmit(){let e=[];"object"===this.returnType?(e=this.backObject(this.files)[0],this.localValue=e||null):(e=this.backObject(this.files),this.localValue||(this.localValue=[]),this.localValue=[...e]),this.$emit("update:modelValue",this.localValue)},backObject(e){let t=[];return e.forEach((e=>{t.push({extname:e.extname,fileType:e.fileType,image:e.image,name:e.name,path:e.path,size:e.size,fileID:e.fileID,url:e.url,uuid:e.uuid,status:e.status,cloudPath:e.cloudPath})})),t},async getTempFileURL(e){e={fileList:[].concat(e)};return(await M.getTempFileURL(e)).fileList[0].tempFileURL||""},getForm(e="uniForms"){let t=this.$parent,i=t.$options.name;for(;i!==e;){if(t=t.$parent,!t)return!1;i=t.$options.name}return t}}},[["render",function(e,t,i,l,s,o){const d=w,p=x,u=_("upload-image"),c=v,f=_("upload-file");return a(),r(p,{class:"uni-file-picker"},{default:n((()=>[i.title?(a(),r(p,{key:0,class:"uni-file-picker__header"},{default:n((()=>[h(d,{class:"file-title"},{default:n((()=>[y($(i.title),1)])),_:1}),h(d,{class:"file-count"},{default:n((()=>[y($(o.filesList.length)+"/"+$(o.limitLength),1)])),_:1})])),_:1})):m("",!0),"image"===i.fileMediatype&&"grid"===o.showType?(a(),r(u,{key:1,readonly:i.readonly,"image-styles":i.imageStyles,"files-list":o.filesList,limit:o.limitLength,disablePreview:i.disablePreview,delIcon:i.delIcon,onUploadFiles:o.uploadFiles,onChoose:o.choose,onDelFile:o.delFile},{default:n((()=>[g(e.$slots,"default",{},(()=>[h(p,{class:"is-add"},{default:n((()=>[h(p,{class:"icon-add"}),h(p,{class:"icon-add rotate"})])),_:1})]),!0)])),_:3},8,["readonly","image-styles","files-list","limit","disablePreview","delIcon","onUploadFiles","onChoose","onDelFile"])):m("",!0),"image"!==i.fileMediatype||"grid"!==o.showType?(a(),r(f,{key:2,readonly:i.readonly,"list-styles":i.listStyles,"files-list":o.filesList,showType:o.showType,delIcon:i.delIcon,onUploadFiles:o.uploadFiles,onChoose:o.choose,onDelFile:o.delFile},{default:n((()=>[g(e.$slots,"default",{},(()=>[h(c,{type:"primary",size:"mini"},{default:n((()=>[y("选择文件")])),_:1})]),!0)])),_:3},8,["readonly","list-styles","files-list","showType","delIcon","onUploadFiles","onChoose","onDelFile"])):m("",!0)])),_:3})}],["__scopeId","data-v-ae18bd15"]]);const ee=D({data:()=>({query:T()[T().length-1].$page.options,res:{},importForm:{type:"merge",file:"",filename:""},importType:[{text:"与本地数据合并",value:"merge"},{text:"覆盖本地数据",value:"cover"}],exportForm:{downloadFilename:`账本_${q(new Date,"","","")}`,type:"txt",json:"",savedPath:""},exportType:[{text:"导出为文本文件（.txt）",value:"txt"},{text:"导出为JSON文件（.json）",value:"json"}]}),computed:{selectTip(){return this.importForm.filename?`已选取文件: ${this.importForm.filename}`:"未选择文件"}},methods:{chooseImportFile(){const e=uni.requireNativePlugin("lemonjk-FileSelect");e.showNativePicker({navTitle:"选择文件以导入",navTextColor:"#ffffff",navBarBgColor:"#5EA0FF",filterConfig:{fileExtension:["txt","json"]}},(t=>{const{filePath:i,fileRealName:s,code:o,fileExtension:a}=t.files[0];1001==o&&P({title:"授权提醒",content:"未授权本应用读取文件权限，请授予权限以选取文件",confirmText:"去授权",cancelText:"拒绝",success(t){t.confirm&&e.gotoSetting()}}),-1!==["txt","json"].indexOf(a)?(this.importForm.filename=s,plus.io.requestFileSystem(plus.io.PUBLIC_DOWNLOADS,(e=>{e.root.getFile(i,{create:!1},(e=>{e.file((e=>{this.importForm.file=e}),(e=>{l({title:"获取文件时出错",icon:"error"})}))}),(e=>{l({title:"无法读取文件",icon:"error"})}))}),(e=>{l({title:"请求授权时出错",icon:"error"})}))):l({title:"文件类型不支持",icon:"error"})}))},selectFile({tempFiles:e}){this.importForm.file=e[0].file},importData(){if(!this.importForm.file)return void l({title:"请先选择文件",icon:"error"});const e=new FileReader;e.readAsText(this.importForm.file),e.onload=t=>{try{const t=JSON.parse(e.result);"cover"===this.importForm.type&&S();for(const e of t.bills){const{id:i}=e,l=I("bills")||[],s=l.findIndex((e=>e.id===i));s>-1&&"merge"===this.importForm.type?(new Date(e.lastModifiedTime)>new Date(l[s].lastModifiedTime)&&(R.assign(l[s],e),j("bills",l)),(t[`bill-${i}-tag-keys`]||[]).forEach((e=>{if((I(`bill-${i}-tag-keys`)||[]).findIndex((t=>t===e))>-1){if(new Date(t[`bill-${i}-tag-${e}`].datetime)>new Date(I(`bill-${i}-tag-${e}`).datetime)){const l=I(`bill-${i}-tag-${e}`);R.assign(l,t[`bill-${i}-tag-${e}`]),j(`bill-${i}-tag-${e}`,l)}}else{const l=I(`bill-${i}-tag-keys`)||[];l.push(e),j(`bill-${i}-tag-keys`,l),j(`bill-${i}-tag-${e}`,t[`bill-${i}-tag-${e}`])}})),(t[`bill-${i}-expense-keys`]||[]).forEach((e=>{if((I(`bill-${i}-expense-keys`)||[]).findIndex((t=>t===e))>-1){if(new Date(t[`bill-${i}-expense-${e}`].lastModifiedTime)>new Date(I(`bill-${i}-expense-${e}`).lastModifiedTime)){const l=I(`bill-${i}-expense-${e}`);R.assignWith(l,t[`bill-${i}-expense-${e}`],((e,t,i)=>"tags"===i?e:void 0)),l.tags=R.uniq([...l.tags,...t[`bill-${i}-expense-${e}`].tags]),j(`bill-${i}-expense-${e}`,l)}}else{const l=I(`bill-${i}-expense-keys`)||[];l.push(e),j(`bill-${i}-expense-keys`,l),j(`bill-${i}-expense-${e}`,t[`bill-${i}-expense-${e}`])}}))):(l.push(e),j(`bill-${i}-expense-keys`,t[`bill-${i}-expense-keys`]),j(`bill-${i}-tag-keys`,t[`bill-${i}-tag-keys`]),(t[`bill-${i}-expense-keys`]||[]).forEach((e=>j(`bill-${i}-expense-${e}`,t[`bill-${i}-expense-${e}`]))),(t[`bill-${i}-tag-keys`]||[]).forEach((e=>j(`bill-${i}-tag-${e}`,t[`bill-${i}-tag-${e}`]))),j("bills",l))}l({title:"导入成功"})}catch(i){l({title:"无法解析数据",icon:"error"})}}},copy(){C({data:JSON.stringify(this.exportForm.json)})},exportData(){if(!this.exportForm.downloadFilename)return void l({title:"文件必须命名",icon:"error"});const{keys:e}=E(),t={};for(const l of e)l.indexOf("bill")>-1&&(t[l]=I(l));if(R.isEmpty(t))return void l({title:"无数据可导出",mask:!0,icon:"error"});this.exportForm.json=t;const{type:i,downloadFilename:s}=this.exportForm,o=window.URL.createObjectURL(new Blob([JSON.stringify(t)])),a=document.createElement("a");a.download=s+"."+i,a.href=o,a.click(),l({title:"导出成功",mask:!0})}}},[["render",function(e,t,i,l,s,o){const d=V(O("uni-data-checkbox"),L),p=V(O("uni-forms-item"),U),u=V(O("uni-file-picker"),Y),c=v,f=V(O("uni-forms"),B),g=V(O("uni-notice-bar"),A),b=V(O("uni-card"),z),F=V(O("uni-easyinput"),N),k=x;return a(),r(k,null,{default:n((()=>[h(b,{"is-full":"",title:"导入数据到本地","sub-title":"导入外部数据并存储到本地",border:!1,class:"br-8 shadow"},{default:n((()=>[h(f,{"label-width":"150rpx",model:s.importForm},{default:n((()=>[h(p,{label:"合并方式"},{default:n((()=>[h(d,{modelValue:s.importForm.type,"onUpdate:modelValue":t[0]||(t[0]=e=>s.importForm.type=e),localdata:s.importType},null,8,["modelValue","localdata"])])),_:1}),h(p,{label:"选择文件"},{default:n((()=>[h(u,{"auto-upload":!1,ref:"fileRef","file-extname":"txt,json",limit:"1","file-mediatype":"all",onSelect:o.selectFile},null,8,["onSelect"])])),_:1}),h(p,{label:""},{default:n((()=>[h(c,{type:"primary",size:"mini",onClick:o.importData},{default:n((()=>[y("开始导入")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),h(g,{text:"仅支持文件后缀为 .json 和 .txt 类型的文件"})])),_:1}),h(b,{title:"导出本地数据","sub-title":"将本地所有数据导出为文件","is-full":"",style:{"margin-top":"16px"},border:!1,class:"br-8 shadow"},{default:n((()=>[h(f,{"label-width":"150rpx",model:s.exportForm},{default:n((()=>[h(p,{label:"导出格式"},{default:n((()=>[h(d,{modelValue:s.exportForm.type,"onUpdate:modelValue":t[1]||(t[1]=e=>s.exportForm.type=e),localdata:s.exportType},null,8,["modelValue","localdata"])])),_:1}),h(p,{label:"文件命名"},{default:n((()=>[h(F,{errorMessage:"",modelValue:s.exportForm.downloadFilename,"onUpdate:modelValue":t[2]||(t[2]=e=>s.exportForm.downloadFilename=e),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),h(p,{label:""},{default:n((()=>[h(c,{type:"primary",size:"mini",onClick:o.exportData},{default:n((()=>[y("开始导出")])),_:1},8,["onClick"]),s.exportForm.json?(a(),r(c,{key:0,onClick:o.copy,size:"mini",class:"ml-8",type:"primary",plain:""},{default:n((()=>[y("复制到剪贴板")])),_:1},8,["onClick"])):m("",!0)])),_:1})])),_:1},8,["model"]),s.exportForm.savedPath?(a(),r(g,{key:0,text:`导出文件保存位置: ${s.exportForm.savedPath}`,color:"#2979FF","background-color":"#EAF2FF"},null,8,["text"])):m("",!0),s.exportForm.json?(a(),r(g,{key:1,text:"如果点击导出按钮未弹出下载提示, 请尝试复制数据到剪贴板并手动粘贴到文件内进行保存"})):m("",!0)])),_:1})])),_:1})}]]);export{ee as default};
